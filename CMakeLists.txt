cmake_minimum_required(VERSION 3.15)
project(SpaceCourier VERSION 1.0 LANGUAGES CXX)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è macOS
set(CMAKE_OSX_DEPLOYMENT_TARGET "11.0")

# –ü—É—Ç–∏ –¥–ª—è Homebrew
set(HOMEBREW_PREFIX "/opt/homebrew")
set(SFML_DIR "${HOMEBREW_PREFIX}")

# –ü–æ–∏—Å–∫ SFML
find_path(SFML_INCLUDE_DIR SFML/Graphics.hpp PATHS "${SFML_DIR}/include")
find_library(SFML_GRAPHICS sfml-graphics PATHS "${SFML_DIR}/lib")
find_library(SFML_WINDOW sfml-window PATHS "${SFML_DIR}/lib") 
find_library(SFML_SYSTEM sfml-system PATHS "${SFML_DIR}/lib")

if(NOT SFML_INCLUDE_DIR OR NOT SFML_GRAPHICS OR NOT SFML_WINDOW OR NOT SFML_SYSTEM)
    message(FATAL_ERROR "SFML not found! Install with: brew install sfml")
endif()

# –í—Å–µ –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
add_executable(SpaceCourier
    src/main.cpp
    src/InputHandler.cpp
    src/Entity.cpp
    src/Player.cpp
    src/Platform.cpp
    src/Level.cpp
)

# –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã
target_include_directories(SpaceCourier PRIVATE include ${SFML_INCLUDE_DIR})

# –õ–∏–Ω–∫–æ–≤–∫–∞ —Å SFML
target_link_libraries(SpaceCourier ${SFML_GRAPHICS} ${SFML_WINDOW} ${SFML_SYSTEM})

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ SFML –±–∏–±–ª–∏–æ—Ç–µ–∫ –¥–ª—è macOS
if(APPLE)
    add_custom_command(TARGET SpaceCourier POST_BUILD
        COMMAND ${CMAKE_COMMAND} -E copy_if_different
        "${SFML_GRAPHICS}"
        $<TARGET_FILE_DIR:SpaceCourier>
        COMMAND ${CMAKE_COMMAND} -E copy_if_different
        "${SFML_WINDOW}"
        $<TARGET_FILE_DIR:SpaceCourier>
        COMMAND ${CMAKE_COMMAND} -E copy_if_different
        "${SFML_SYSTEM}"
        $<TARGET_FILE_DIR:SpaceCourier>
        COMMENT "Copying SFML libraries for macOS"
    )
endif()

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ assets –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏
add_custom_command(TARGET SpaceCourier POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E copy_directory
    ${CMAKE_SOURCE_DIR}/assets
    $<TARGET_FILE_DIR:SpaceCourier>/assets
    COMMENT "Copying assets to output directory"
)

# –ü–æ–ª–µ–∑–Ω—ã–µ —Ü–µ–ª–∏
add_custom_target(run
    COMMAND ./SpaceCourier
    WORKING_DIRECTORY ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}
    DEPENDS SpaceCourier
    COMMENT "Running Space Courier..."
)

add_custom_target(clean-all
    COMMAND ${CMAKE_COMMAND} -E remove_directory ${CMAKE_BINARY_DIR}
    COMMENT "Cleaning all build files"
)

# –í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
message(STATUS " ")
message(STATUS "üéØ Space Courier Configuration:")
message(STATUS "   Build Type: ${CMAKE_BUILD_TYPE}")
message(STATUS "   C++ Standard: ${CMAKE_CXX_STANDARD}")
message(STATUS "   SFML Include: ${SFML_INCLUDE_DIR}")
message(STATUS "   SFML Libraries: ${SFML_GRAPHICS}, ${SFML_WINDOW}, ${SFML_SYSTEM}")
message(STATUS "   Output: ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/SpaceCourier")
message(STATUS " ")